<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zapater칤a Moderna</title>
<style>
/* ---------- RESET ---------- */
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: Arial, sans-serif; color: #d9d9d9; background: radial-gradient(circle at top right, #0088cc 0%, #001020 40%, #000814 100%); background-attachment: fixed; }

/* ---------- HEADER ---------- */
header { background: linear-gradient(90deg,#001020,#003355); color: #d9d9d9; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
header h1 { font-size: 1.8rem; }
#cart { cursor: pointer; font-size: 1.1rem; transition: transform .2s; }
#cart:hover { transform: scale(1.05); }

/* ---------- PRODUCTOS ---------- */
.product-list { display: flex; flex-wrap: wrap; gap: 20px; padding: 20px; justify-content: center; }
.product { background: #001a2a; border-radius: 10px; padding: 15px; width: 260px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.5); transition: transform .2s, box-shadow .2s; }
.product:hover { transform: scale(1.05); box-shadow: 0 6px 15px rgba(0,0,0,0.6); }
.product img { width: 100%; height: 200px; border-radius: 8px; object-fit: cover; cursor: pointer; }
.product h3 { margin: 10px 0 5px; color: #c0e0ff; }

button { padding: 10px 15px; background: #00aaff; color: #001020; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; font-size: .95rem; font-weight: bold; transition: background .2s, transform .2s; }
button:hover { background: #33cfff; transform: scale(1.05); }

/* ---------- ADMIN PANEL ---------- */
.admin-panel { background: #00111f; padding: 20px; margin: 20px auto; max-width: 400px; border-radius: 10px; color: #d9d9d9; border: 1px solid #0088cc; }
.admin-panel input { width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #004466; background: #001a2a; color: #d9d9d9; }
.hidden { display: none; }

/* ---------- MODAL ---------- */
.modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 200; opacity: 0; pointer-events: none; transition: opacity .3s; }
.modal:not(.hidden) { opacity: 1; pointer-events: auto; }

.modal-content { background: #001a2a; padding: 20px; width: 90%; max-width: 350px; border-radius: 10px; text-align: center; transform: scale(0.5); transition: transform .3s; color: #d9d9d9; border: 1px solid #0088cc; }
.modal:not(.hidden) .modal-content { transform: scale(1); }

.close { float: right; cursor: pointer; font-size: 20px; color: #00aaff; }

.sizes button { background: #002a44; color: #d9d9d9; margin: 5px 3px; padding: 8px 12px; border-radius: 6px; border: 1px solid #0088cc; transition: background .2s; }
.sizes button:hover { background: #004466; }
.sizes button.selected { background: #00aaff !important; color: #001020 !important; }

.product.out-of-stock { opacity: 0.5; }
.product.out-of-stock button { background: #6c757d; cursor: not-allowed; }

/* ---------- CARRITO ---------- */
#cart-items { max-height: 200px; overflow-y: auto; text-align: left; margin: 10px 0; }
#cart-items .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #ccc; }
#cart-items .cart-item button { background-color: #dc3545; color: white; border: none; padding: 3px 8px; border-radius: 4px; cursor: pointer; transition: background .2s; }
#cart-items .cart-item button:hover { background-color: #c12c2c; }

/* ---------- TOAST ---------- */
.toast { position: fixed; bottom: 20px; right: 20px; background: #00111f; color: #d9d9d9; padding: 12px 20px; border-radius: 6px; opacity: 0; cursor: pointer; transition: opacity .3s; border: 1px solid #0088cc; }
.toast.show { opacity: 1; }

/* ---------- RESPONSIVE ---------- */
@media(max-width: 600px) {
  .product-list { flex-direction: column; align-items: center; }
  .product { width: 90%; }
  .admin-panel { width: 90%; }
}

footer { text-align: center; padding: 10px 0; color: #c0e0ff; font-size: 0.9rem; background: rgba(0,0,0,0.3); position: fixed; bottom: 0; width: 100%; border-top: 1px solid #0088cc; }
</style>
</head>
<body>

<header>
  <h1>Zapater칤a Moderna</h1>
  <div id="cart" onclick="openCart()">游 Carrito: <span id="cart-count">0</span></div>
</header>

<main>
  <section id="product-list" class="product-list"></section>

  <button id="admin-btn">游댏 Modo administrador</button>

  <section id="admin-section" class="hidden admin-panel">
    <h2>Administrador</h2>
    <form id="add-form">
      <input type="text" id="name" placeholder="Nombre del zapato" required>
      <input type="number" id="price" placeholder="Precio" step="0.01" required>
      <input type="file" id="image" accept="image/*" required>
      <input type="text" id="sizes" placeholder="Tallas (ej: 38,39,40)" required>
      <button type="submit">Agregar</button>
    </form>
  </section>
</main>

<!-- MODAL TALLAS -->
<div id="size-modal" class="modal hidden">
  <div class="modal-content animate">
    <span id="close-modal" class="close">&times;</span>
    <h2 id="modal-product-name"></h2>
    <div id="size-options" class="sizes"></div>
    <button id="buy-btn">Agregar al carrito</button>
  </div>
</div>

<!-- MODAL CARRITO -->
<div id="cart-modal" class="modal hidden">
  <div class="modal-content animate">
    <span id="close-cart" class="close">&times;</span>
    <h2>Tu carrito</h2>
    <div id="cart-items"></div>
    <h3>Total: C$<span id="cart-total">0.00</span></h3>
    <button onclick="checkout()">Comprar por WhatsApp</button>
  </div>
</div>

<div id="toast" class="toast hidden"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-storage.js";
import { getDatabase, ref as dbRef, push, set, onValue } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

// ===== CONFIG FIREBASE =====
const firebaseConfig = {
  apiKey: "AIzaSyBjbzxSrLjp3qgl8qaYDfQQgVX5E7DqxUs",
  authDomain: "zapateria-3d5da.firebaseapp.com",
  databaseURL: "https://zapateria-3d5da-default-rtdb.firebaseio.com",
  projectId: "zapateria-3d5da",
  storageBucket: "zapateria-3d5da.appspot.com"
  messagingSenderId: "885381797478",
  appId: "1:885381797478:web:860afaaf0584275bd43fa7",
  measurementId: "G-4MP0B60M4W"
};

const app = initializeApp(firebaseConfig);
const storage = getStorage(app);
const database = getDatabase(app);

// ===== CONFIG GENERAL =====
const adminPhone = "50583647398";
const adminPassword = "1234";
let selectedProduct = null;
let selectedSize = null;
let isAdmin = false;
let cart = JSON.parse(localStorage.getItem("cart")) || [];
let products = [];

// ===== TOAST =====
function toast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.remove("hidden");
  t.classList.add("show");
  setTimeout(()=>{ t.classList.remove("show"); t.classList.add("hidden"); },2500);
}

// ===== FUNCIONES =====
function renderProducts(){
  const list = document.getElementById("product-list");
  list.innerHTML="";
  products.forEach((p,i)=>{
    const isDisabled = !p.available;
    list.innerHTML += `
      <div class="product">
        <img src="${p.image}" onclick="${isDisabled ? 'toast(`Producto agotado`)' : `openSizes(${i})`}">
        <h3>${p.name} ${!p.available?'<span style="color:red">(Agotado)</span>':''}</h3>
        <p>C$${p.price.toFixed(2)}</p>
        <button ${isDisabled?'disabled':''} onclick="openSizes(${i})">
          ${isDisabled?'Agotado':'Ver tallas'}
        </button>
        ${isAdmin?`
          <button onclick="deleteProduct(${i})" style="background:#dc3545;margin-top:5px">Eliminar</button>
          <button onclick="toggleAvailability(${i})" style="background:#ffc107;margin-top:5px">
            ${p.available?"Marcar como agotado":"Volver disponible"}
          </button>
        `:''}
      </div>
    `;
  });
}

// ADMIN
document.getElementById("admin-btn").onclick = ()=>{
  const password = prompt("Contrase침a de administrador:");
  if(password!==adminPassword) return toast("Contrase침a incorrecta");
  isAdmin = !isAdmin;
  toast(isAdmin?"Modo administrador activado":"Modo administrador desactivado");
  document.getElementById("admin-section").classList.toggle("hidden");
  renderProducts();
};

// AGREGAR PRODUCTO
document.getElementById("add-form").onsubmit = async (e)=>{
  e.preventDefault();
  if(!isAdmin) return toast("Acci칩n no permitida");
  const name = document.getElementById("name").value.trim();
  const price = parseFloat(document.getElementById("price").value);
  const file = document.getElementById("image").files[0];
  const sizes = document.getElementById("sizes").value.split(",").map(s=>Number(s.trim())).filter(n=>!isNaN(n));
  if(!name || !file || sizes.length===0 || isNaN(price)) return toast("Datos inv치lidos");
  toast("Subiendo imagen...");

  try{
    const storageReference = storageRef(storage, `productos/${Date.now()}_${file.name}`);
    await uploadBytes(storageReference, file);
    const imageURL = await getDownloadURL(storageReference);
    const productsReference = dbRef(database,'products');
    await push(productsReference,{ name, price, image:imageURL, sizes, available:true });
    e.target.reset();
    toast("Producto agregado con 칠xito");
  }catch(err){ console.error(err); toast("Error subiendo imagen"); }
};

// ESCUCHAR PRODUCTOS EN TIEMPO REAL
const productsReference = dbRef(database,'products');
onValue(productsReference,(snapshot)=>{
  const data = snapshot.val();
  products=[];
  if(data) products=Object.keys(data).map(key=>({ id:key, ...data[key] }));
  renderProducts();
});

// ELIMINAR Y TOGGLE DISPONIBILIDAD
window.deleteProduct = async (i)=>{
  if(!isAdmin) return toast("Acci칩n no permitida");
  if(!confirm("쮼liminar producto?")) return;
  await set(dbRef(database,'products/'+products[i].id),null);
  toast("Producto eliminado");
};

window.toggleAvailability = async (i)=>{
  const p = products[i];
  await set(dbRef(database,'products/'+p.id),{...p, available:!p.available});
  toast(p.available?"Agotado":"Disponible");
};

// MODAL TALLAS
window.openSizes = (index)=>{
  selectedProduct = products[index]; selectedSize=null;
  document.getElementById("modal-product-name").textContent = selectedProduct.name;
  const modalContent = document.querySelector("#size-modal .modal-content");
  const oldImg = modalContent.querySelector("img.large"); if(oldImg) oldImg.remove();
  const img = document.createElement("img"); img.src=selectedProduct.image; img.classList.add("large"); modalContent.prepend(img);
  const box = document.getElementById("size-options"); box.innerHTML="";
  selectedProduct.sizes.forEach(size=>{ const btn=document.createElement("button"); btn.textContent=size; btn.onclick=()=>selectSize(size,btn); box.appendChild(btn); });
  document.getElementById("buy-btn").disabled=true;
  document.getElementById("size-modal").classList.remove("hidden");
};

function selectSize(size,btn){
  selectedSize=size;
  document.querySelectorAll("#size-options button").forEach(b=>b.classList.remove("selected"));
  btn.classList.add("selected");
  document.getElementById("buy-btn").disabled=false;
  toast(`Talla ${size} seleccionada`);
}

// CARRITO
document.getElementById("buy-btn").onclick = ()=>{
  if(!selectedSize) return;
  cart.push({ name:selectedProduct.name, price:selectedProduct.price, size:selectedSize, image:selectedProduct.image });
  localStorage.setItem("cart",JSON.stringify(cart));
  updateCartCount();
  toast("Agregado al carrito");
  document.getElementById("size-modal").classList.add("hidden");
};

function updateCartCount(){ document.getElementById("cart-count").textContent=cart.length; }

window.openCart = ()=>{
  const items = document.getElementById("cart-items"); items.innerHTML=""; let total=0;
  cart.forEach((item,index)=>{ total+=item.price; items.innerHTML+=`<div class="cart-item"><span>${item.name} (talla ${item.size}) - C$${item.price.toFixed(2)}</span><button onclick="removeFromCart(${index})">Eliminar</button></div>`; });
  document.getElementById("cart-total").textContent=total.toFixed(2);
  document.getElementById("cart-modal").classList.remove("hidden");
};

window.removeFromCart=(i)=>{ cart.splice(i,1); localStorage.setItem("cart",JSON.stringify(cart)); openCart(); updateCartCount(); };

// WHATSAPP
window.checkout=()=>{
  if(cart.length===0) return toast("El carrito est치 vac칤o");
  let msg="Hola, quiero comprar:\n\n";
  cart.forEach(item=>{ msg+=`- ${item.name} (talla ${item.size}) - C$${item.price.toFixed(2)}\nImagen: ${item.image}\n\n`; });
  const url=`https://wa.me/${adminPhone}?text=${encodeURIComponent(msg)}`;
  window.open(url,"_blank");
};

// CIERRE MODALES
document.getElementById("close-modal").onclick=()=>document.getElementById("size-modal").classList.add("hidden");
document.getElementById("close-cart").onclick=()=>document.getElementById("cart-modal").classList.add("hidden");

updateCartCount();
</script>

<footer>Creado por Kennedy Casco</footer>
</body>
</html>

